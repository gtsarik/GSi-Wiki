<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gsi.views &#8212; GSi 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="GSi 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">GSi 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gsi.views</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">annoying.decorators</span> <span class="k">import</span> <span class="n">render_to</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">login_required</span><span class="p">,</span> <span class="n">user_passes_test</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="k">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="k">import</span> <span class="n">FormView</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="k">import</span> <span class="n">ContentType</span>

<span class="kn">from</span> <span class="nn">gsi.models</span> <span class="k">import</span> <span class="p">(</span><span class="n">Run</span><span class="p">,</span> <span class="n">RunStep</span><span class="p">,</span> <span class="n">Log</span><span class="p">,</span> <span class="n">OrderedCardItem</span><span class="p">,</span> <span class="n">HomeVariables</span><span class="p">,</span>
                        <span class="n">VariablesGroup</span><span class="p">,</span> <span class="n">YearGroup</span><span class="p">,</span> <span class="n">Year</span><span class="p">,</span> <span class="n">Satellite</span><span class="p">,</span>
                        <span class="n">InputDataDirectory</span><span class="p">,</span> <span class="n">SubCardItem</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">,</span> <span class="n">Tile</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">cards.card_update_create</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">cards.cards_forms</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gsi.gsi_items_update_create</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gsi.gsi_forms</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">core.utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">make_run</span><span class="p">,</span> <span class="n">get_dir_root_static_path</span><span class="p">,</span>
                        <span class="n">get_path_folder_run</span><span class="p">,</span> <span class="n">slash_remove_from_path</span><span class="p">,</span>
                        <span class="n">get_files_dirs</span><span class="p">,</span> <span class="n">create_sub_dir</span><span class="p">,</span> <span class="n">get_copy_name</span><span class="p">,</span>
                        <span class="n">get_files</span><span class="p">,</span> <span class="n">get_card_model</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">core.get_post</span> <span class="k">import</span> <span class="n">get_post</span>
<span class="kn">from</span> <span class="nn">core.copy_card</span> <span class="k">import</span> <span class="n">create_copycard</span>
<span class="kn">from</span> <span class="nn">log.logger</span> <span class="k">import</span> <span class="n">get_logs</span>
<span class="kn">from</span> <span class="nn">gsi.settings</span> <span class="k">import</span> <span class="p">(</span><span class="n">PATH_RUNS_SCRIPTS</span><span class="p">,</span> <span class="n">CONFIGFILE_PATH</span><span class="p">,</span> <span class="n">GOOGLE_MAP_ZOOM</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">core.paginations</span> <span class="k">import</span> <span class="n">paginations</span>

<span class="n">TITLES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;home&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Home&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">],</span>
    <span class="s1">&#39;setup_run&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GSI Run Setup&#39;</span><span class="p">,</span> <span class="s1">&#39;run_setup&#39;</span><span class="p">],</span>
    <span class="s1">&#39;edit_run&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GSI Edit Run&#39;</span><span class="p">,</span> <span class="s1">&#39;run_update&#39;</span><span class="p">],</span>
    <span class="s1">&#39;new_run&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GSI New Run&#39;</span><span class="p">,</span> <span class="s1">&#39;new_run&#39;</span><span class="p">],</span>
    <span class="s1">&#39;card_sequence&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GSI Card Sequence&#39;</span><span class="p">,</span> <span class="s1">&#39;card_sequence&#39;</span><span class="p">],</span>
    <span class="s1">&#39;add_card_sequence&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GSI New Card Sequence&#39;</span><span class="p">,</span> <span class="s1">&#39;new_card_sequence&#39;</span><span class="p">],</span>
    <span class="s1">&#39;card_item_update&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GSI Card Item&#39;</span><span class="p">,</span> <span class="s1">&#39;card_item_update&#39;</span><span class="p">],</span>
<span class="p">}</span>


<div class="viewcode-block" id="handle_uploaded_file"><a class="viewcode-back" href="../gsi.html#gsi.views.handle_uploaded_file">[docs]</a><span class="k">def</span> <span class="nf">handle_uploaded_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">destination</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">chunks</span><span class="p">():</span>
            <span class="n">destination</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_qrf_rftrain_card"><a class="viewcode-back" href="../gsi.html#gsi.views.update_qrf_rftrain_card">[docs]</a><span class="k">def</span> <span class="nf">update_qrf_rftrain_card</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">cs_cards</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">cards.models</span> <span class="k">import</span> <span class="n">QRF</span><span class="p">,</span> <span class="n">RFTrain</span>

    <span class="n">configfile</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">configfile</span>
    <span class="n">qrf_directory</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.cfg&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rftrain_configfile</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CONFIGFILE_PATH</span><span class="p">,</span> <span class="n">configfile</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">cs_cards</span><span class="p">:</span>
        <span class="n">card_model</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span>

        <span class="k">if</span> <span class="n">card_model</span> <span class="o">==</span> <span class="s1">&#39;qrf&#39;</span><span class="p">:</span>
            <span class="n">data_card</span> <span class="o">=</span> <span class="n">QRF</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">content_object</span><span class="p">)</span>
            <span class="n">data_card</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">qrf_directory</span>
            <span class="n">data_card</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">card_model</span> <span class="o">==</span> <span class="s1">&#39;rftrain&#39;</span><span class="p">:</span>
            <span class="n">data_card</span> <span class="o">=</span> <span class="n">RFTrain</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">content_object</span><span class="p">)</span>
            <span class="n">data_card</span><span class="o">.</span><span class="n">config_file</span> <span class="o">=</span> <span class="n">rftrain_configfile</span>
            <span class="n">data_card</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>


<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/blocking.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="blocking"><a class="viewcode-back" href="../gsi.html#gsi.views.blocking">[docs]</a><span class="k">def</span> <span class="nf">blocking</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="UploadStaticDataView"><a class="viewcode-back" href="../gsi.html#gsi.views.UploadStaticDataView">[docs]</a><span class="k">class</span> <span class="nc">UploadStaticDataView</span><span class="p">(</span><span class="n">FormView</span><span class="p">):</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="s1">&#39;index.html&#39;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UploadFileForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/upload_file.html&#39;</span>

<div class="viewcode-block" id="UploadStaticDataView.get_context_data"><a class="viewcode-back" href="../gsi.html#gsi.views.UploadStaticDataView.get_context_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">UploadStaticDataView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Upload Test Data&#39;</span>
        <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;upload_file&#39;</span>
        <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
            <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">context</span></div>

<div class="viewcode-block" id="UploadStaticDataView.form_valid"><a class="viewcode-back" href="../gsi.html#gsi.views.UploadStaticDataView.form_valid">[docs]</a>    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">home_var</span> <span class="o">=</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;test_data&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">path_test_data</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_var</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="c1"># type_file = str(request.FILES[&#39;test_data&#39;].content_type).split(&#39;/&#39;)[0]</span>
        <span class="n">handle_uploaded_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;test_data&#39;</span><span class="p">],</span> <span class="n">path_test_data</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Test data &quot;</span><span class="si">{0}</span><span class="s1">&quot; is loaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                    <span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">),</span> <span class="n">message</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="write_card_to_cs"><a class="viewcode-back" href="../gsi.html#gsi.views.write_card_to_cs">[docs]</a><span class="k">def</span> <span class="nf">write_card_to_cs</span><span class="p">(</span><span class="n">card_sequence</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="n">dict_carditem_order</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">carditem_select</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;carditem_select&#39;</span><span class="p">)</span>
    <span class="n">carditem_order</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;carditem_order&#39;</span><span class="p">)</span>
    <span class="n">num_card</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">carditem_select</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">num_card</span><span class="p">):</span>
        <span class="n">card_item</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardItem</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">carditem_select</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>

        <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">sequence</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">,</span>
            <span class="n">card_item</span><span class="o">=</span><span class="n">card_item</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">carditem_order</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span> <span class="p">)</span></div>


<div class="viewcode-block" id="create_new_runbase"><a class="viewcode-back" href="../gsi.html#gsi.views.create_new_runbase">[docs]</a><span class="k">def</span> <span class="nf">create_new_runbase</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">new_rb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rb</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">rb_count</span> <span class="o">=</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">copy_name_rb</span> <span class="o">=</span> <span class="n">get_copy_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">new_name_rb</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">*cp</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name_rb</span><span class="p">,</span> <span class="n">rb_count</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">new_name_rb</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_name_rb</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_name_rb</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rb_count</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">new_name_rb</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">*cp</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_name_rb</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="c1"># except TypeError:</span>
        <span class="c1"># 	num_name = int(name_list[2:][0]) + 1</span>
        <span class="c1"># 	new_name_rb = &#39;{0}*cp{1}&#39;.format(name, num_name)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_rb</span> <span class="o">=</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">new_name_rb</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">purpose</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">purpose</span><span class="p">,</span>
            <span class="n">directory_path</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">directory_path</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">new_rb_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardSequence</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">new_rb</span><span class="o">.</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">new_rb_cs</span><span class="o">.</span><span class="n">environment_base</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">environment_base</span>
        <span class="n">new_rb_cs</span><span class="o">.</span><span class="n">environment_override</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">environment_override</span>
        <span class="n">new_rb_cs</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">new_rb_cs_cards</span> <span class="o">=</span> <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">sequence_id</span><span class="o">=</span><span class="n">new_rb_cs</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">CardSequence</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">new_rb_cs</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">copy_rb_cs_cards</span> <span class="o">=</span> <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">sequence_id</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">copy_rb_cs_cards</span><span class="p">:</span>
            <span class="n">card_model</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span>
            <span class="n">new_copy_card</span> <span class="o">=</span> <span class="n">create_copycard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">card_item</span><span class="p">),</span> <span class="n">card_model</span><span class="p">)</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">ContentType</span><span class="p">,</span> <span class="n">app_label</span><span class="o">=</span><span class="s1">&#39;cards&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">card_model</span><span class="p">)</span>
            <span class="n">card_item</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">CardItem</span><span class="p">,</span>
                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">new_copy_card</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="c1"># print &#39;new_copy_card ============================= &#39;, new_copy_card</span>
            <span class="c1"># name_ci = str(n.card_item)</span>
            <span class="c1"># new_name_ci = &#39;{0}*cp{1}&#39;.format(name_ci, rb_count)</span>
            <span class="c1"># print &#39;NAME content_type ============= &#39;, str(n.card_item)</span>
            <span class="c1"># print &#39;NAME NEW content_type ============= &#39;, new_name_ci</span>
            <span class="c1"># print &#39;content_type ============= &#39;, n.card_item.content_type.model</span>

            <span class="c1"># new_card_item = n.card_item</span>
            <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">sequence</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">,</span>
                <span class="n">card_item</span><span class="o">=</span><span class="n">card_item</span><span class="p">,</span>
                <span class="n">order</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;ERROR create_new_runbase ============== &#39;</span><span class="p">,</span> <span class="n">e</span>

    <span class="k">return</span> <span class="n">new_rb</span></div>


<div class="viewcode-block" id="get_number_cards"><a class="viewcode-back" href="../gsi.html#gsi.views.get_number_cards">[docs]</a><span class="k">def</span> <span class="nf">get_number_cards</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="n">num_card</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># run = get_object_or_404(Run, run_base=rb, user=user)</span>
    <span class="n">all_card</span> <span class="o">=</span> <span class="n">OrderedCardItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sequence__runbase</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">run_base</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">all_card</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">run_parallel</span><span class="p">:</span>
            <span class="n">num_card</span> <span class="o">+=</span> <span class="n">card</span><span class="o">.</span><span class="n">number_sub_cards</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_card</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">num_card</span></div>


<span class="c1"># upload_static_data_view = user_passes_test(login_url=&#39;/&#39;, redirect_field_name=&#39;&#39;)(UploadStaticDataView.as_view())</span>


<span class="nd">@user_passes_test</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">)</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/upload_file.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="upload_file"><a class="viewcode-back" href="../gsi.html#gsi.views.upload_file">[docs]</a><span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Upload Test Data&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;upload_file&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">home_var</span> <span class="o">=</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">home_var</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UploadFileForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">home_var</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;test_data&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">path_test_data</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_var</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span><span class="p">,</span>
                                              <span class="n">file_name</span><span class="p">)</span>
                <span class="n">handle_uploaded_file</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;test_data&#39;</span><span class="p">],</span>
                                     <span class="n">path_test_data</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;upload_file&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">u&#39;Test data &quot;</span><span class="si">{0}</span><span class="s1">&quot; is loaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))))</span>

                <span class="c1"># type_file = str(request.FILES[&#39;test_data&#39;].content_type).split(&#39;/&#39;)[0]</span>
                <span class="c1"># if type_file != &#39;image&#39;:</span>
                <span class="c1"># 	handle_uploaded_file(request.FILES[&#39;test_data&#39;], path_test_data)</span>
                <span class="c1"># 	return HttpResponseRedirect(</span>
                <span class="c1"># 			u&#39;%s?status_message=%s&#39; % (reverse(&#39;index&#39;),</span>
                <span class="c1"># 			(u&#39;Test data &quot;{0}&quot; is loaded&#39;.format(file_name)))</span>
                <span class="c1"># 	)</span>
                <span class="c1"># else:</span>
                <span class="c1"># 	return HttpResponseRedirect(</span>
                <span class="c1"># 			u&#39;%s?status_message=%s&#39; % (reverse(&#39;index&#39;),</span>
                <span class="c1"># 			(u&#39;The file &quot;{0}&quot; can not be loaded. \</span>
                <span class="c1"># 			To download using a text file format&#39;.format(file_name)))</span>
                <span class="c1"># 	)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">u&#39;Please fill the Home Variables.&#39;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;upload_file&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">u&#39;Sorry. Upload error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">form</span><span class="p">[</span><span class="s1">&#39;test_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">as_text</span><span class="p">()))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UploadFileForm</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/index.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="index"><a class="viewcode-back" href="../gsi.html#gsi.views.index">[docs]</a><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Main Menu&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;home&#39;</span>
    <span class="n">is_homevar</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">home_var</span> <span class="o">=</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">home_var</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span><span class="p">:</span>
            <span class="n">is_homevar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">home_var</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UploadFileForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">home_var</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;test_data&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">path_test_data</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_var</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span><span class="p">,</span>
                                              <span class="n">file_name</span><span class="p">)</span>
                <span class="c1"># type_file = str(request.FILES[&#39;test_data&#39;].content_type).split(&#39;/&#39;)[0]</span>
                <span class="n">handle_uploaded_file</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;test_data&#39;</span><span class="p">],</span>
                                     <span class="n">path_test_data</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">u&#39;Test data &quot;</span><span class="si">{0}</span><span class="s1">&quot; is loaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">u&#39;Please fill the Home Variables.&#39;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">u&#39;Upload error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">form</span><span class="p">[</span>
                    <span class="s1">&#39;test_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">as_text</span><span class="p">()))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UploadFileForm</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span> <span class="s1">&#39;is_homevar&#39;</span><span class="p">:</span> <span class="n">is_homevar</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/run_setup.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="run_setup"><a class="viewcode-back" href="../gsi.html#gsi.views.run_setup">[docs]</a><span class="k">def</span> <span class="nf">run_setup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Run Setup&#39;</span>
    <span class="n">run_bases</span> <span class="o">=</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-date_modified&#39;</span><span class="p">)</span>
    <span class="n">run_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;run_setup&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;date_created&#39;</span><span class="p">,</span> <span class="s1">&#39;date_modified&#39;</span><span class="p">):</span>
            <span class="n">run_bases</span> <span class="o">=</span> <span class="n">run_bases</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">run_bases</span> <span class="o">=</span> <span class="n">run_bases</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy_btn&#39;</span><span class="p">):</span>
            <span class="n">run_bases_current</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy_btn&#39;</span><span class="p">))</span>
            <span class="n">run_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">run_bases_current</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">new_rb</span> <span class="o">=</span> <span class="n">create_new_runbase</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_bases_current</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;run_setup&#39;</span>
            <span class="p">),</span> <span class="p">(</span><span class="s1">u&#39;Run the </span><span class="si">{0}</span><span class="s1"> has been successfully copied. Creates a copy of the &quot;</span><span class="si">{1}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span>
                <span class="nb">format</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">new_rb</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;run_select&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy_btn&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_select&#39;</span><span class="p">):</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
                <span class="n">run_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">rb_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                    <span class="n">CardSequence</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">cur_run</span><span class="o">.</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">cur_run</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                <span class="n">rb_cs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">run_name</span> <span class="o">=</span> <span class="n">run_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_setup&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Run(s): </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">run_bases_current</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">run_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">run_bases_current</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">rb_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">CardSequence</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">run_bases_current</span><span class="o">.</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">run_bases_current</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">rb_cs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_setup&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Run: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_setup&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Run or more Runs.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_bases</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;run_bases&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/new_run.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="new_run"><a class="viewcode-back" href="../gsi.html#gsi.views.new_run">[docs]</a><span class="k">def</span> <span class="nf">new_run</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;New Run&#39;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cards_item</span> <span class="o">=</span> <span class="n">CardItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RunForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">new_run_base</span> <span class="o">=</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                    <span class="n">purpose</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;purpose&quot;</span><span class="p">],</span>
                    <span class="c1"># card_sequence=form.cleaned_data[&quot;card_sequence&quot;],</span>
                    <span class="n">directory_path</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;directory_path&quot;</span><span class="p">],</span>
                    <span class="n">resolution</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
                    <span class="n">author</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="p">)</span>

                <span class="n">path_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">new_run_base</span><span class="o">.</span><span class="n">resolution</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">new_run_base</span><span class="o">.</span><span class="n">directory_path</span><span class="p">))</span>
                <span class="n">create_sub_dir</span><span class="p">(</span><span class="n">path_dir</span><span class="p">)</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">new_run_base</span><span class="o">.</span><span class="n">card_sequence</span>

                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;carditem_select&#39;</span><span class="p">):</span>
                        <span class="n">write_card_to_cs</span><span class="p">(</span><span class="n">card_sequence</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_setup&#39;</span><span class="p">),</span> <span class="p">(</span>
                            <span class="s2">u&quot;RunID </span><span class="si">{0}</span><span class="s2"> created successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">new_run_base</span><span class="o">.</span><span class="n">id</span><span class="p">))))</span>
                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_update_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;carditem_select&#39;</span><span class="p">):</span>
                        <span class="n">write_card_to_cs</span><span class="p">(</span><span class="n">card_sequence</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">reverse</span><span class="p">(</span>
                            <span class="s1">&#39;run_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">new_run_base</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s2">u&quot;RunID </span><span class="si">{0}</span><span class="s2"> created successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                         <span class="nb">format</span><span class="p">(</span><span class="n">new_run_base</span><span class="o">.</span><span class="n">id</span><span class="p">))))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;new_run&#39;</span><span class="p">),</span> <span class="p">(</span>
                        <span class="s1">u&#39;Run with the name &quot;</span><span class="si">{0}</span><span class="s1">&quot; already exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RunForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s1">&#39;cards_item&#39;</span><span class="p">:</span> <span class="n">cards_item</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/run_update.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="run_update"><a class="viewcode-back" href="../gsi.html#gsi.views.run_update">[docs]</a><span class="k">def</span> <span class="nf">run_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="n">run_base</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Edit &quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cur_run</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RunForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cancel_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?info_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_setup&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;Run </span><span class="si">{0}</span><span class="s2"> updated canceled&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">cur_run</span> <span class="o">=</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">cur_run</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">run_base</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                        <span class="n">run_base</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
                        <span class="n">run_base</span><span class="o">.</span><span class="n">purpose</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;purpose&quot;</span><span class="p">]</span>
                        <span class="c1"># run_base.card_sequence = form.cleaned_data[&quot;card_sequence&quot;]</span>
                        <span class="n">run_base</span><span class="o">.</span><span class="n">directory_path</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span>
                            <span class="s2">&quot;directory_path&quot;</span><span class="p">]</span>
                        <span class="n">run_base</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
                        <span class="c1"># run_base.author = request.user</span>
                        <span class="n">run_base</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                        <span class="n">path_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">run_base</span><span class="o">.</span><span class="n">resolution</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">run_base</span><span class="o">.</span><span class="n">directory_path</span><span class="p">))</span>
                        <span class="n">create_sub_dir</span><span class="p">(</span><span class="n">path_dir</span><span class="p">)</span>

                        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_setup&#39;</span><span class="p">),</span> <span class="p">(</span>
                                <span class="s2">u&quot;Run </span><span class="si">{0}</span><span class="s2"> updated successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
                    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edit_run_details_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?info_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">reverse</span><span class="p">(</span>
                                <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span>
                                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">run_base</span><span class="o">.</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span> <span class="p">(</span>
                                    <span class="s2">u&quot;Edit Card Sequence </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">run_base</span><span class="o">.</span><span class="n">card_sequence</span><span class="p">))))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">reverse</span><span class="p">(</span>
                            <span class="s1">&#39;run_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s1">u&#39;Run with the name &quot;</span><span class="si">{0}</span><span class="s1">&quot; already exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RunForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">run_base</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;run_base&#39;</span><span class="p">:</span> <span class="n">run_base</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/run_new_card_sequence_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="run_new_card_sequence_list"><a class="viewcode-back" href="../gsi.html#gsi.views.run_new_card_sequence_list">[docs]</a><span class="k">def</span> <span class="nf">run_new_card_sequence_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Card Sequences&#39;</span>
    <span class="n">card_sequences</span> <span class="o">=</span> <span class="n">CardSequence</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">cs_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cs_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
                <span class="n">cur_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardSequence</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
                <span class="n">cs_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_cs</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_cs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_new_card_sequence_list&#39;</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s1">u&#39;Card Sequence: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cs_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_new_card_sequence_list&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Card Sequence or more Card Sequences.&quot;</span><span class="p">)))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;card_sequences&#39;</span><span class="p">:</span> <span class="n">card_sequences</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/card_sequence.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="card_sequence"><a class="viewcode-back" href="../gsi.html#gsi.views.card_sequence">[docs]</a><span class="k">def</span> <span class="nf">card_sequence</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="n">card_sequences</span> <span class="o">=</span> <span class="n">CardSequence</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Card Sequences&#39;</span>
    <span class="n">cs_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cs_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
                <span class="n">cur_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardSequence</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
                <span class="n">cs_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_cs</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_cs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;card_sequence&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span> <span class="p">(</span>
                    <span class="s1">u&#39;Card Sequence: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cs_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;card_sequence&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Card Sequence or more Card Sequences.&quot;</span><span class="p">)))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;card_sequences&#39;</span><span class="p">:</span> <span class="n">card_sequences</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/add_card_sequence.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="run_new_card_sequence_add"><a class="viewcode-back" href="../gsi.html#gsi.views.run_new_card_sequence_add">[docs]</a><span class="k">def</span> <span class="nf">run_new_card_sequence_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;New Card Sequence&#39;</span>
    <span class="n">href</span> <span class="o">=</span> <span class="s1">&#39;run_new_card_sequence_add&#39;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;create_processing_card&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;proces_card_new_run&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;add_card_items_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># import pdb;pdb.set_trace()</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;run_new_card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The new card item &#39;</span><span class="si">{0}</span><span class="s2">&#39; was changed successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_and_continue_editing_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;run_new_card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The card sequence &#39;</span><span class="si">{0}</span><span class="s2">&#39; created successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;new_run&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">u&quot;The card sequence &#39;</span><span class="si">{0}</span><span class="s2">&#39; created successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cancel_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?info_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                        <span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_new_card_sequence_list&#39;</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s2">u&quot;Card Sequence created canceled&quot;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">href</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/card_sequence_update.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="run_new_card_sequence_update"><a class="viewcode-back" href="../gsi.html#gsi.views.run_new_card_sequence_update">[docs]</a><span class="k">def</span> <span class="nf">run_new_card_sequence_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">):</span>
    <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardSequence</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
    <span class="n">card_sequence_cards</span> <span class="o">=</span> <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">sequence_id</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Card Sequence </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_process_card</span> <span class="o">=</span> <span class="s1">&#39;run_new_card_sequence_update&#39;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;create_processing_card&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;proces_card_run_new_csid&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">cs_id</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;add_card_items_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;run_new_card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The new card item &#39;</span><span class="si">{0}</span><span class="s2">&#39; was changed successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_and_continue_editing_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;run_new_card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The new card item &#39;</span><span class="si">{0}</span><span class="s2">&#39; was changed successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;new_run&#39;</span><span class="p">),</span> <span class="p">(</span>
                        <span class="s2">u&quot;The card sequence &#39;</span><span class="si">{0}</span><span class="s2">&#39; update successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="c1"># card_sequence = create_update_card_sequence(form, cs_id)</span>

                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
                    <span class="n">cs_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">card_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
                        <span class="n">cur_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                            <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span>
                        <span class="n">cs_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_cs</span><span class="o">.</span><span class="n">card_item</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                        <span class="n">cur_cs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">reverse</span><span class="p">(</span>
                            <span class="s1">&#39;run_new_card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">cs_id</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s1">u&#39;Card Sequence: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cs_name</span><span class="p">))))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">reverse</span><span class="p">(</span>
                            <span class="s1">&#39;run_new_card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">cs_id</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s2">u&quot;To delete, select Card Sequence or more Card Sequences.&quot;</span>
                         <span class="p">)))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cancel_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?info_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                        <span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_new_card_sequence_list&#39;</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s2">u&quot;Card Sequence update canceled&quot;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;cs_id&#39;</span><span class="p">:</span> <span class="n">cs_id</span><span class="p">,</span>
        <span class="s1">&#39;card_sequence_cards&#39;</span><span class="p">:</span> <span class="n">card_sequence_cards</span><span class="p">,</span>
        <span class="s1">&#39;card_sequence&#39;</span><span class="p">:</span> <span class="n">card_sequence</span><span class="p">,</span>
        <span class="s1">&#39;url_process_card&#39;</span><span class="p">:</span> <span class="n">url_process_card</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/add_card_sequence.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="add_card_sequence"><a class="viewcode-back" href="../gsi.html#gsi.views.add_card_sequence">[docs]</a><span class="k">def</span> <span class="nf">add_card_sequence</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="n">card_items</span> <span class="o">=</span> <span class="n">CardItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;New Card Sequence&#39;</span>
    <span class="n">href</span> <span class="o">=</span> <span class="s1">&#39;add_card_sequence </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;create_processing_card&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;proces_card_runid&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;add_card_items_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The new card item &#39;</span><span class="si">{0}</span><span class="s2">&#39; was changed successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_and_continue_editing_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The card sequence &#39;</span><span class="si">{0}</span><span class="s2">&#39; created successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;card_sequence&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span> <span class="p">(</span>
                    <span class="s2">u&quot;The card sequence &#39;</span><span class="si">{0}</span><span class="s2">&#39; created successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cancel_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?info_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;card_sequence&#39;</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span> <span class="p">(</span><span class="s2">u&quot;Card Sequence created canceled&quot;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;card_items&#39;</span><span class="p">:</span> <span class="n">card_items</span><span class="p">,</span>
        <span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">href</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/card_sequence_update.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="card_sequence_update"><a class="viewcode-back" href="../gsi.html#gsi.views.card_sequence_update">[docs]</a><span class="k">def</span> <span class="nf">card_sequence_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">):</span>
    <span class="n">home_var</span> <span class="o">=</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">rf_auxdata_path</span> <span class="o">=</span> <span class="n">home_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span>
    <span class="n">files</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">rf_auxdata_path</span><span class="p">,</span> <span class="s1">&#39;.cfg&#39;</span><span class="p">)</span>
    <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardSequence</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
    <span class="n">card_sequence_cards</span> <span class="o">=</span> <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">sequence_id</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Card Sequence </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_process_card</span> <span class="o">=</span> <span class="s1">&#39;proces_card_sequence_card_edit&#39;</span>
    <span class="n">cs_configfile</span> <span class="o">=</span> <span class="n">card_sequence</span><span class="o">.</span><span class="n">configfile</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">REVERCE_URL</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;qrf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_qrf&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;rfscore&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_rfscore&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;remap&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_remap&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;yearfilter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_year_filter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;collate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_collate&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;preproc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_preproc&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;mergecsv&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_mergecsv&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;rftrain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_rftrain&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;randomforest&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_randomforest&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;calcstats&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;new_runid_csid_calcstats&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]],</span>
        <span class="s1">&#39;cancel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]]</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">cs_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">cs_id</span><span class="p">:</span>
                <span class="c1"># cur_run = get_object_or_404(RunBase, pk=int(r))</span>
                <span class="n">cur_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                    <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_cs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">cs_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cs_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_cs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>
        <span class="n">data_configfile</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;configfile&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_card&#39;</span><span class="p">):</span>
            <span class="n">new_card</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_card&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="n">REVERCE_URL</span><span class="p">[</span><span class="n">new_card</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="n">REVERCE_URL</span><span class="p">[</span><span class="n">new_card</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;add_card_items_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">data_post</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The new card item &#39;</span><span class="si">{0}</span><span class="s2">&#39; was changed successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_and_continue_editing_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">data_post</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">data_configfile</span><span class="p">:</span>
                    <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span>
                        <span class="n">form</span><span class="p">,</span> <span class="n">configfile</span><span class="o">=</span><span class="n">data_configfile</span><span class="p">,</span> <span class="n">cs_id</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
                    <span class="n">update_qrf_rftrain_card</span><span class="p">(</span><span class="n">card_sequence</span><span class="p">,</span> <span class="n">card_sequence_cards</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span>
                        <span class="n">form</span><span class="p">,</span> <span class="n">cs_id</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_sequence</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;The new card item &#39;</span><span class="si">{0}</span><span class="s2">&#39; was update successfully. You may edit it again below.&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">data_post</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">data_configfile</span><span class="p">:</span>
                    <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span>
                        <span class="n">form</span><span class="p">,</span> <span class="n">configfile</span><span class="o">=</span><span class="n">data_configfile</span><span class="p">,</span> <span class="n">cs_id</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>
                    <span class="n">update_qrf_rftrain_card</span><span class="p">(</span><span class="n">card_sequence</span><span class="p">,</span> <span class="n">card_sequence_cards</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span>
                        <span class="n">form</span><span class="p">,</span> <span class="n">cs_id</span><span class="o">=</span><span class="n">cs_id</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;run_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span> <span class="p">(</span>
                    <span class="s2">u&quot;The card sequence &#39;</span><span class="si">{0}</span><span class="s2">&#39; update successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">data_post</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">card_sequence</span> <span class="o">=</span> <span class="n">create_update_card_sequence</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
                    <span class="n">cs_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">cs_card_id</span> <span class="ow">in</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;cs_select&#39;</span><span class="p">):</span>
                        <span class="c1"># import pdb;pdb.set_trace()</span>
                        <span class="n">cur_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                            <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">cs_card_id</span><span class="p">)</span>
                        <span class="n">cs_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_cs</span><span class="o">.</span><span class="n">card_item</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                        <span class="n">cur_cs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">reverse</span><span class="p">(</span>
                            <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s1">u&#39;Card Items: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cs_name</span><span class="p">))))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">reverse</span><span class="p">(</span>
                            <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s2">u&quot;To delete, select Card Item or more Card Items.&quot;</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;del_current_btn&#39;</span><span class="p">):</span>
            <span class="n">card_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;del_current_btn&#39;</span><span class="p">)</span>
            <span class="n">cur_cs</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span>
            <span class="n">cs_name</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_cs</span><span class="o">.</span><span class="n">card_item</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
            <span class="n">cur_cs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">u&#39;Card Item: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cs_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">data_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cancel_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?info_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;run_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span> <span class="p">(</span>
                    <span class="s1">u&#39;Card Sequence &quot;</span><span class="si">{0}</span><span class="s1">&quot; created canceled&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">card_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCreateForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">card_sequence</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;cs_id&#39;</span><span class="p">:</span> <span class="n">cs_id</span><span class="p">,</span>
        <span class="s1">&#39;card_sequence_cards&#39;</span><span class="p">:</span> <span class="n">card_sequence_cards</span><span class="p">,</span>
        <span class="s1">&#39;card_sequence&#39;</span><span class="p">:</span> <span class="n">card_sequence</span><span class="p">,</span>
        <span class="s1">&#39;url_process_card&#39;</span><span class="p">:</span> <span class="n">url_process_card</span><span class="p">,</span>
        <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="n">files</span><span class="p">,</span>
        <span class="s1">&#39;cs_configfile&#39;</span><span class="p">:</span> <span class="n">cs_configfile</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># card item edit for card sequence</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/card_item_update.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="card_item_update"><a class="viewcode-back" href="../gsi.html#gsi.views.card_item_update">[docs]</a><span class="k">def</span> <span class="nf">card_item_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">,</span> <span class="n">card_item_id</span><span class="p">):</span>
    <span class="n">card_sequence_card</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
        <span class="n">CardSequence</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">through</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">card_item_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Card ItemID </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_item_id</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCardForm</span><span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">card_sequence_card</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">CardItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;card_item&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
                    <span class="n">card_sequence_card</span><span class="o">.</span><span class="n">card_item</span> <span class="o">=</span> <span class="n">card</span>
                <span class="n">card_sequence_card</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
                <span class="n">card_sequence_card</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]),</span> <span class="p">(</span>
                        <span class="s2">u&quot;Card Item </span><span class="si">{0}</span><span class="s2"> updated successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">card_sequence_card</span><span class="o">.</span><span class="n">card_item</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cancel_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?info_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;card_sequence_update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cs_id</span><span class="p">]),</span> <span class="p">(</span>
                    <span class="s2">u&quot;Card Item </span><span class="si">{0}</span><span class="s2"> updated canceled&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">card_sequence_card</span><span class="o">.</span><span class="n">card_item</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CardSequenceCardForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">card_sequence_card</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;card_sequence_card&#39;</span><span class="p">:</span> <span class="n">card_sequence_card</span><span class="p">,</span>
        <span class="s1">&#39;cs_id&#39;</span><span class="p">:</span> <span class="n">cs_id</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># submit a run</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/submit_run.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="submit_run"><a class="viewcode-back" href="../gsi.html#gsi.views.submit_run">[docs]</a><span class="k">def</span> <span class="nf">submit_run</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># import pdb;pdb.set_trace()</span>
    <span class="n">run_bases</span> <span class="o">=</span> <span class="n">RunBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-date_modified&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Submit a Run&#39;</span>
    <span class="n">name_runs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;submit_run&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;date_created&#39;</span><span class="p">,</span> <span class="s1">&#39;date_modified&#39;</span><span class="p">):</span>
            <span class="n">run_bases</span> <span class="o">=</span> <span class="n">run_bases</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">run_bases</span> <span class="o">=</span> <span class="n">run_bases</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
                <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
                <span class="n">rb</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
                <span class="n">execute_run</span> <span class="o">=</span> <span class="n">make_run</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">execute_run</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="s1">u&#39;Unable to execute the Run. Please contact the administrator!&#39;</span>
                    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">execute_run</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="s1">u&#39;&lt;b&gt;ERROR&lt;/b&gt;: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">execute_run</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="n">num_cards</span> <span class="o">=</span> <span class="n">get_number_cards</span><span class="p">(</span><span class="n">execute_run</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
                <span class="n">now_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">now_date_formating</span> <span class="o">=</span> <span class="n">now_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
                <span class="n">now_time</span> <span class="o">=</span> <span class="n">now_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s1">u&#39;Run &quot;</span><span class="si">{0}</span><span class="s1">&quot; has been submitted to back end and </span><span class="si">{1}</span><span class="s1"> on </span><span class="si">{2}</span><span class="s1">&lt;br&gt;Processed </span><span class="si">{3}</span><span class="s1"> Cards&#39;</span><span class="o">.</span>\
                 <span class="nb">format</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">now_time</span><span class="p">,</span> <span class="n">now_date_formating</span><span class="p">,</span> <span class="n">num_cards</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s2">u&quot;For start choose Run&quot;</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># if request.POST.get(&#39;execute_runs&#39;, &#39;&#39;):</span>
            <span class="c1"># 	run_id = request.POST.get(&#39;execute_runs&#39;, &#39;&#39;)</span>
            <span class="c1"># 	# for run_id in id_runs:</span>
            <span class="c1"># 	# 	rb = get_object_or_404(RunBase, pk=run_id)</span>
            <span class="c1"># 	# 	# execute_run = make_run(rb, request.user)</span>
            <span class="c1"># 	# 	name_runs += &#39;&quot;&#39; + str(rb.name) + &#39;&quot;, &#39;</span>
            <span class="c1">#</span>
            <span class="c1"># 	rb = get_object_or_404(RunBase, pk=run_id)</span>
            <span class="c1"># 	execute_run = make_run(rb, request.user)</span>
            <span class="c1">#</span>
            <span class="c1"># 	if not execute_run:</span>
            <span class="c1"># 		return HttpResponseRedirect(u&#39;%s?danger_message=%s&#39; %</span>
            <span class="c1"># 									(reverse(&#39;submit_run&#39;),</span>
            <span class="c1"># 									 (u&#39;Unable to execute the Run. \</span>
            <span class="c1"># 									 Please contact the administrator!&#39;)))</span>
            <span class="c1">#</span>
            <span class="c1"># 	now_date = datetime.now()</span>
            <span class="c1"># 	now_date_formating = now_date.strftime(&quot;%d/%m/%Y&quot;)</span>
            <span class="c1"># 	now_time = now_date.strftime(&quot;%H:%M&quot;)</span>
            <span class="c1">#</span>
            <span class="c1"># 	print &#39;execute_run&#39;</span>
            <span class="c1">#</span>
            <span class="c1"># 	return HttpResponseRedirect(u&#39;%s?status_message=%s&#39; %</span>
            <span class="c1"># 				(reverse(&#39;submit_run&#39;),</span>
            <span class="c1"># 				 (u&#39;Run &quot;{0}&quot; has been submitted to back end and {1} on {2}&#39;.</span>
            <span class="c1"># 				  format(rb.name, now_time, now_date_formating)))</span>
            <span class="c1"># 	)</span>
            <span class="c1"># else:</span>
            <span class="c1"># 	return HttpResponseRedirect(u&#39;%s?warning_message=%s&#39; % (reverse(&#39;submit_run&#39;),</span>
            <span class="c1"># 								 (u&quot;For start choose Run(s)&quot;))</span>
            <span class="c1"># 	)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;ERROR submit_run ====================== &#39;</span><span class="p">,</span> <span class="n">e</span>
            <span class="c1"># ***********************************************************************</span>
            <span class="c1"># write log file</span>
            <span class="n">path_file</span> <span class="o">=</span> <span class="s1">&#39;/home/gsi/LOGS/submit_run.log&#39;</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">log_submit_run_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">log_submit_run_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">))</span>
            <span class="n">log_submit_run_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;ERROR = </span><span class="si">{0}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">log_submit_run_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">log_submit_run_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1"># ***********************************************************************</span>

        <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_bases</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;run_bases&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># execute run</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/execute_run.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="execute_runs"><a class="viewcode-back" href="../gsi.html#gsi.views.execute_runs">[docs]</a><span class="k">def</span> <span class="nf">execute_runs</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Execute Run&#39;</span>
    <span class="n">list_run_id</span> <span class="o">=</span> <span class="n">run_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">name_runs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">list_run_id</span><span class="p">:</span>
        <span class="n">name_runs</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">Run</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run</span><span class="p">))</span><span class="o">.</span><span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s1">&#39;It has been assigned unique run ID: </span><span class="si">{0}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">To view progress of this run use </span><span class="se">\</span>
<span class="s1">						the view progress option on the main menu.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># run progress</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/run_progress.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="run_progress"><a class="viewcode-back" href="../gsi.html#gsi.views.run_progress">[docs]</a><span class="k">def</span> <span class="nf">run_progress</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">runs</span> <span class="o">=</span> <span class="n">Run</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Run Progress&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;run_progress&#39;</span>
    <span class="n">run_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;run_base&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">runs</span> <span class="o">=</span> <span class="n">runs</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;run_base__name&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">runs</span> <span class="o">=</span> <span class="n">runs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;run_date&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">):</span>
            <span class="n">runs</span> <span class="o">=</span> <span class="n">runs</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">runs</span> <span class="o">=</span> <span class="n">runs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Run</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_run</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;run_progress&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_progress&#39;</span><span class="p">):</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Run</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
                <span class="n">run_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_run</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_run</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

                <span class="c1"># delete folder Run(s) from server</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">run_folder</span> <span class="o">=</span> <span class="s1">&#39;R_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_RUNS_SCRIPTS</span><span class="p">,</span> <span class="n">run_folder</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="n">run_name</span> <span class="o">=</span> <span class="n">run_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_progress&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Run(s): </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;run_progress&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Run or more Runs.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">runs</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;runs&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># details run</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/run_details.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="run_details"><a class="viewcode-back" href="../gsi.html#gsi.views.run_details">[docs]</a><span class="k">def</span> <span class="nf">run_details</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="n">sub_title</span> <span class="o">=</span> <span class="s1">&#39;The View Log file select and hit view&#39;</span>
    <span class="n">runs_step</span> <span class="o">=</span> <span class="n">RunStep</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent_run</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">runs_step</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;card_item__order&#39;</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;run_details&#39;</span>

    <span class="k">if</span> <span class="n">runs_step</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Run &quot;</span><span class="si">{0}</span><span class="s1">&quot; Details&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">runs_step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent_run</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;No data to display&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;card_item_id&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;card_item__id&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;card_item&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;card_item__card_item__name&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;card_item__order&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">):</span>
            <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">runs_step</span> <span class="o">=</span> <span class="n">runs_step</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_file&#39;</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">RunStep</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_file&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;out_button&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span>
                        <span class="s1">&#39;view_log_file&#39;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;Out&#39;</span><span class="p">]),</span>
                    <span class="p">(</span><span class="s1">u&#39;Log Out file for the Card &quot;</span><span class="si">{0}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">card_item</span><span class="p">)</span>
                     <span class="p">)))</span>
            <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;err_button&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;view_log_file&#39;</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">]),</span> <span class="p">(</span>
                        <span class="s1">u&#39;Log Error file for the Card &quot;</span><span class="si">{0}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">step</span><span class="o">.</span><span class="n">card_item</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                <span class="s1">&#39;run_details&#39;</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span> <span class="p">(</span><span class="s2">u&quot;To view the Card Log, select Card.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">runs_step</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;sub_title&#39;</span><span class="p">:</span> <span class="n">sub_title</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;runs_step&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;obj_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># view out/error log files for cards</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/view_log_file.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="view_log_file"><a class="viewcode-back" href="../gsi.html#gsi.views.view_log_file">[docs]</a><span class="k">def</span> <span class="nf">view_log_file</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="n">log_info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Run</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">runs_step</span> <span class="o">=</span> <span class="n">RunStep</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent_run</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">run_step_card</span> <span class="o">=</span> <span class="n">RunStep</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">card_item__id</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Log </span><span class="si">{0}</span><span class="s1"> file for the Card Item &quot;</span><span class="si">{1}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
    <span class="n">sub_title</span> <span class="o">=</span> <span class="s1">&#39;The View Log file select and hit view&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">log_file_path</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">log_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">run_step_card</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">get_path_folder_run</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">Log</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">log_name</span><span class="p">,</span> <span class="n">log_file</span><span class="o">=</span><span class="n">log_name</span><span class="p">,</span> <span class="n">log_file_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
        <span class="n">run</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="n">run</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Out&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">card_name</span> <span class="o">=</span> <span class="s1">&#39;runcard_</span><span class="si">{0}</span><span class="s1">.out&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_id</span><span class="p">)</span>
            <span class="n">path_log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">log_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">card_name</span><span class="p">))</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_log_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fd</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">log_info</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;ERROR Out view_log_file: &#39;</span><span class="p">,</span> <span class="n">e</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;run_details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">u&#39;Log Out file &quot;</span><span class="si">{0}</span><span class="s1">&quot; not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_name</span><span class="p">))))</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">card_name</span> <span class="o">=</span> <span class="s1">&#39;runcard_</span><span class="si">{0}</span><span class="s1">.err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_id</span><span class="p">)</span>
            <span class="n">path_log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">log_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">card_name</span><span class="p">))</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_log_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fd</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">log_info</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;ERROR Error view_log_file: &#39;</span><span class="p">,</span> <span class="n">e</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;run_details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">u&#39;Log Error file &quot;</span><span class="si">{0}</span><span class="s1">&quot; not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_name</span><span class="p">))))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;card_id&#39;</span><span class="p">:</span> <span class="n">card_id</span><span class="p">,</span>
        <span class="s1">&#39;log_info&#39;</span><span class="p">:</span> <span class="n">log_info</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># view out/error log files for cards</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/view_log_file_sub_card.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="view_log_file_sub_card"><a class="viewcode-back" href="../gsi.html#gsi.views.view_log_file_sub_card">[docs]</a><span class="k">def</span> <span class="nf">view_log_file_sub_card</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="n">log_info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">runs_step</span> <span class="o">=</span> <span class="n">RunStep</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent_run</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">run_step_card</span> <span class="o">=</span> <span class="n">RunStep</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">card_item__id</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Log </span><span class="si">{0}</span><span class="s1"> file for the Sub Card &quot;</span><span class="si">{1}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">run_step_card</span><span class="o">.</span><span class="n">card_item</span><span class="p">)</span>
    <span class="n">sub_title</span> <span class="o">=</span> <span class="s1">&#39;The View Log file select and hit view&#39;</span>

    <span class="n">run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Run</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">log_file_path</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">log_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">run_step_card</span><span class="o">.</span><span class="n">card_item</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">get_path_folder_run</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">Log</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">log_name</span><span class="p">,</span> <span class="n">log_file</span><span class="o">=</span><span class="n">log_name</span><span class="p">,</span> <span class="n">log_file_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
        <span class="n">run</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="n">run</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c1"># card_name = &#39;&#39;</span>
    <span class="c1"># path_log_file = os.path.join(str(log_path), str(card_name))</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Out&#39;</span><span class="p">:</span>
        <span class="n">card_name</span> <span class="o">=</span> <span class="s1">&#39;runcard_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">.out&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_id</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">path_log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">log_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">card_name</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_log_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fd</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">log_info</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;ERROR Out view_log_file_sub_card: &#39;</span><span class="p">,</span> <span class="n">e</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;sub_card_details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">u&#39;Log Out file &quot;</span><span class="si">{0}</span><span class="s1">&quot; not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_name</span><span class="p">))))</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span>
        <span class="n">card_name</span> <span class="o">=</span> <span class="s1">&#39;runcard_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">.err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_id</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">path_log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">log_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">card_name</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_log_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fd</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">log_info</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;ERROR Error view_log_file_sub_card: &#39;</span><span class="p">,</span> <span class="n">e</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?danger_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;sub_card_details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">u&#39;Log Error file &quot;</span><span class="si">{0}</span><span class="s1">&quot; not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_name</span><span class="p">))))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;card_id&#39;</span><span class="p">:</span> <span class="n">card_id</span><span class="p">,</span>
        <span class="s1">&#39;log_info&#39;</span><span class="p">:</span> <span class="n">log_info</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># details parallel card of run</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/sub_card_details.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="sub_card_details"><a class="viewcode-back" href="../gsi.html#gsi.views.sub_card_details">[docs]</a><span class="k">def</span> <span class="nf">sub_card_details</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">):</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;sub_card_details&#39;</span>
    <span class="n">sub_cards</span> <span class="o">=</span> <span class="n">SubCardItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span>
    <span class="n">sub_cards</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;sub_cards.start_time&#39;</span><span class="p">)</span>
    <span class="c1"># runs_step = RunStep.objects.filter(parent_run=run_id).first()</span>
    <span class="n">run_step_card</span> <span class="o">=</span> <span class="n">RunStep</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">card_item__id</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Sub Cards of Card &quot;</span><span class="si">{0}</span><span class="s1">&quot; Details&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_step_card</span><span class="o">.</span><span class="n">card_item</span><span class="p">)</span>
    <span class="n">sub_title</span> <span class="o">=</span> <span class="s1">&#39;The View Log file select and hit view&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">):</span>
            <span class="n">sub_cards</span> <span class="o">=</span> <span class="n">sub_cards</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">sub_cards</span> <span class="o">=</span> <span class="n">sub_cards</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_file&#39;</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;err_button&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">log_err</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_file&#39;</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">log_err</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;view_log_file_sub_card&#39;</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">]),</span> <span class="p">(</span>
                        <span class="s1">u&#39;Log Error file for the Card &quot;</span><span class="si">{0}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">run_step_card</span><span class="o">.</span><span class="n">card_item</span><span class="p">))))</span>
            <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;out_button&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">log_err</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_file&#39;</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">log_err</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;view_log_file_sub_card&#39;</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="s1">&#39;Out&#39;</span><span class="p">]),</span> <span class="p">(</span>
                        <span class="s1">u&#39;Log Out file for the Card &quot;</span><span class="si">{0}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">run_step_card</span><span class="o">.</span><span class="n">card_item</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span>
                    <span class="s1">&#39;sub_card_details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">run_id</span><span class="p">,</span> <span class="n">card_id</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">u&quot;To view the Card Log, select Card.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">sub_cards</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;sub_title&#39;</span><span class="p">:</span> <span class="n">sub_title</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;card_id&#39;</span><span class="p">:</span> <span class="n">card_id</span><span class="p">,</span>
        <span class="s1">&#39;sub_cards&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;card_name&#39;</span><span class="p">:</span> <span class="n">run_step_card</span><span class="o">.</span><span class="n">card_item</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;obj_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># setup static data</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_setup.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="static_data_setup"><a class="viewcode-back" href="../gsi.html#gsi.views.static_data_setup">[docs]</a><span class="k">def</span> <span class="nf">static_data_setup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Setup Static Data&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># setup home variable</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/home_variable_setup.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="home_variable_setup"><a class="viewcode-back" href="../gsi.html#gsi.views.home_variable_setup">[docs]</a><span class="k">def</span> <span class="nf">home_variable_setup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Home Variables&#39;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;home_variable&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">HomeVariablesForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">variables</span><span class="p">:</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">SAT_TIF_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;SAT_TIF_DIR_ROOT&quot;</span><span class="p">]</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">RF_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;RF_DIR_ROOT&quot;</span><span class="p">]</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">USER_DATA_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;USER_DATA_DIR_ROOT&quot;</span><span class="p">]</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">MODIS_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;MODIS_DIR_ROOT&quot;</span><span class="p">]</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;RF_AUXDATA_DIR&quot;</span><span class="p">]</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">SAT_DIF_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;SAT_DIF_DIR_ROOT&quot;</span><span class="p">]</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">variables</span> <span class="o">=</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                        <span class="n">SAT_TIF_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;SAT_TIF_DIR_ROOT&quot;</span><span class="p">],</span>
                        <span class="n">RF_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;RF_DIR_ROOT&quot;</span><span class="p">],</span>
                        <span class="n">USER_DATA_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;USER_DATA_DIR_ROOT&quot;</span><span class="p">],</span>
                        <span class="n">MODIS_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;MODIS_DIR_ROOT&quot;</span><span class="p">],</span>
                        <span class="n">RF_AUXDATA_DIR</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;RF_AUXDATA_DIR&quot;</span><span class="p">],</span>
                        <span class="n">SAT_DIF_DIR_ROOT</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;SAT_DIF_DIR_ROOT&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home_variable_setup&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">u&quot;Home variables successfully updated&quot;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_and_continue_button&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home_variable_setup&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">u&quot;Home variables successfully updated&quot;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">HomeVariablesForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">HomeVariablesForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># environment group</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/environment_groups_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="environment_groups"><a class="viewcode-back" href="../gsi.html#gsi.views.environment_groups">[docs]</a><span class="k">def</span> <span class="nf">environment_groups</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Environment Groups&#39;</span>
    <span class="n">environments</span> <span class="o">=</span> <span class="n">VariablesGroup</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">env_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;environment_groups&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">environments</span> <span class="o">=</span> <span class="n">environments</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">environments</span> <span class="o">=</span> <span class="n">environments</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">VariablesGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">VariablesGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;env_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">env_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;env_select&#39;</span><span class="p">):</span>
                <span class="n">cur_env</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">VariablesGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">env_id</span><span class="p">)</span>
                <span class="n">env_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_env</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_env</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">envs_ids</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;env_select&#39;</span><span class="p">))</span>
            <span class="n">env_name</span> <span class="o">=</span> <span class="n">env_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;environment_groups&#39;</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s1">u&#39;Environment Groups: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_env</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">VariablesGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">env_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_env</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
            <span class="n">cur_env</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;environment_groups&#39;</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s1">u&#39;Environment Group: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;environment_groups&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Group or more Groups.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">environments</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;environments&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># environment group add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="environment_group_add"><a class="viewcode-back" href="../gsi.html#gsi.views.environment_group_add">[docs]</a><span class="k">def</span> <span class="nf">environment_group_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Environment Group Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;environment_group_add&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_env_group_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_groups&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_group_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_group_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_groups&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">var_group_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;environment_groups&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">EnvironmentGroupsForm</span><span class="p">,</span>
                            <span class="s1">&#39;Environment Group&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">EnvironmentGroupsForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># environment group add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="environment_group_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.environment_group_edit">[docs]</a><span class="k">def</span> <span class="nf">environment_group_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">env_id</span><span class="p">):</span>
    <span class="n">env_item</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">VariablesGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">env_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Environment Group &quot;</span><span class="si">{0}</span><span class="s1">&quot; Edit&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env_item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;environment_group_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_env_group_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_groups&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_group_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_groups&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;environment_groups&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">var_group_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;environment_groups&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># import pdb;pdb.set_trace()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">EnvironmentGroupsForm</span><span class="p">,</span>
            <span class="s1">&#39;Environment Group&#39;</span><span class="p">,</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">env_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">EnvironmentGroupsForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">env_item</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">env_id</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># area</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/areas_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="areas"><a class="viewcode-back" href="../gsi.html#gsi.views.areas">[docs]</a><span class="k">def</span> <span class="nf">areas</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Areas&#39;</span>
    <span class="n">areas</span> <span class="o">=</span> <span class="n">Area</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">area_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;areas&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">areas</span> <span class="o">=</span> <span class="n">areas</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">areas</span> <span class="o">=</span> <span class="n">areas</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Area</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Area</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;area_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">area_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;area_select&#39;</span><span class="p">):</span>
                <span class="n">cur_area</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Area</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">area_id</span><span class="p">)</span>
                <span class="n">area_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_area</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_area</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">area_ids</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;env_select&#39;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;areas&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Areas: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_area</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">Area</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">area_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_area</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
            <span class="n">cur_area</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;areas&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Areas: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;areas&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s2">u&quot;To delete, select Area or more Areas.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">areas</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;areas&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># area add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="area_add"><a class="viewcode-back" href="../gsi.html#gsi.views.area_add">[docs]</a><span class="k">def</span> <span class="nf">area_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Area Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;area_add&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_area_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;area_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;area_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;areas&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">area_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;areas&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">available_tiles</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">AreasForm</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AreasForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;available_tiles&#39;</span><span class="p">:</span> <span class="n">available_tiles</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># area edit</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="area_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.area_edit">[docs]</a><span class="k">def</span> <span class="nf">area_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">area_id</span><span class="p">):</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Area</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">area_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Area Edit &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;area_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_area_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;area_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;area_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;areas&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">area_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;areas&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">chosen_tiles</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">available_tiles</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">area</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span>
        <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span> <span class="n">AreasForm</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">item_id</span><span class="o">=</span><span class="n">area_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AreasForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">area</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">area_id</span><span class="p">,</span>
        <span class="s1">&#39;available_tiles&#39;</span><span class="p">:</span> <span class="n">available_tiles</span><span class="p">,</span>
        <span class="s1">&#39;chosen_tiles&#39;</span><span class="p">:</span> <span class="n">chosen_tiles</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># year group group</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/years_group_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="years_group"><a class="viewcode-back" href="../gsi.html#gsi.views.years_group">[docs]</a><span class="k">def</span> <span class="nf">years_group</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Years Groups&#39;</span>
    <span class="n">years_groups</span> <span class="o">=</span> <span class="n">YearGroup</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">yg_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;years_group&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">years_groups</span> <span class="o">=</span> <span class="n">years_groups</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">years_groups</span> <span class="o">=</span> <span class="n">years_groups</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">YearGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">YearGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yg_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">yg_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;yg_select&#39;</span><span class="p">):</span>
                <span class="n">cur_yg</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">YearGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">yg_id</span><span class="p">)</span>
                <span class="n">yg_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_yg</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_yg</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">yg_name</span> <span class="o">=</span> <span class="n">yg_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;years_group&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Years Groups: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yg_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_yg</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">YearGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">yg_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_yg</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">cur_yg</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;years_group&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Years Group: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yg_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;years_group&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Years Group or more Years Groups.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">years_groups</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;years_groups&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># year group add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="years_group_add"><a class="viewcode-back" href="../gsi.html#gsi.views.years_group_add">[docs]</a><span class="k">def</span> <span class="nf">years_group_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Years Groups Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;years_group_add&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;years_group&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_years_group_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">yg_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">available_years</span> <span class="o">=</span> <span class="n">Year</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">YearGroupForm</span><span class="p">,</span> <span class="s1">&#39;Year Group&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span>
                            <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AreasForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;available_years&#39;</span><span class="p">:</span> <span class="n">available_years</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># year group edit</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="years_group_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.years_group_edit">[docs]</a><span class="k">def</span> <span class="nf">years_group_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">yg_id</span><span class="p">):</span>
    <span class="n">years_group</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">YearGroup</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">yg_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;YearGroup Edit &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">years_group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;years_group&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;years_group_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_years_group_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years_group&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">yg_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">chosen_years</span> <span class="o">=</span> <span class="n">years_group</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">available_years</span> <span class="o">=</span> <span class="n">Year</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
        <span class="n">id__in</span><span class="o">=</span><span class="n">years_group</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span>
            <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">YearGroupForm</span><span class="p">,</span>
            <span class="s1">&#39;Year Group&#39;</span><span class="p">,</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">yg_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AreasForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">years_group</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">yg_id</span><span class="p">,</span>
        <span class="s1">&#39;available_years&#39;</span><span class="p">:</span> <span class="n">available_years</span><span class="p">,</span>
        <span class="s1">&#39;chosen_years&#39;</span><span class="p">:</span> <span class="n">chosen_years</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># satellite list</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/satellite_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="satellite"><a class="viewcode-back" href="../gsi.html#gsi.views.satellite">[docs]</a><span class="k">def</span> <span class="nf">satellite</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Satellites&#39;</span>
    <span class="n">satellites</span> <span class="o">=</span> <span class="n">Satellite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">satellite_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;satellite&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">satellites</span> <span class="o">=</span> <span class="n">satellites</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">satellites</span> <span class="o">=</span> <span class="n">satellites</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Satellite</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Satellite</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;satellite_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">satellite_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;satellite_select&#39;</span><span class="p">):</span>
                <span class="n">cur_satellite</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Satellite</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">satellite_id</span><span class="p">)</span>
                <span class="n">satellite_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_satellite</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_satellite</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">satellite_name</span> <span class="o">=</span> <span class="n">satellite_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;satellite&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Satellites: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">satellite_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_satellite</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">Satellite</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">satellite_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_satellite</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">cur_satellite</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;satellite&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Satellite: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">satellite_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;satellite&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Satellite or more Satellites.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">satellites</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;satellites&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># satellite add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="satellite_add"><a class="viewcode-back" href="../gsi.html#gsi.views.satellite_add">[docs]</a><span class="k">def</span> <span class="nf">satellite_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Satellites Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;satellite_add&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;satellite&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_satellite_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">satellite_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">available_satellite</span> <span class="o">=</span> <span class="n">Satellite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">SatelliteForm</span><span class="p">,</span> <span class="s1">&#39;Satellite&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span>
                            <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SatelliteForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;available_satellite&#39;</span><span class="p">:</span> <span class="n">available_satellite</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># satellite edit</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="satellite_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.satellite_edit">[docs]</a><span class="k">def</span> <span class="nf">satellite_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">satellite_id</span><span class="p">):</span>
    <span class="n">satellite</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Satellite</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">satellite_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Satellite Edit &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">satellite</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;satellite&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;satellite_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_satellite_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;satellite&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">satellite_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">SatelliteForm</span><span class="p">,</span>
            <span class="s1">&#39;Satellite&#39;</span><span class="p">,</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">satellite_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SatelliteForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">satellite</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">satellite_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># InputDataDirectory list</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/input_data_dir_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="input_data_dir_list"><a class="viewcode-back" href="../gsi.html#gsi.views.input_data_dir_list">[docs]</a><span class="k">def</span> <span class="nf">input_data_dir_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Input Data Directory&#39;</span>
    <span class="n">input_data_dirs</span> <span class="o">=</span> <span class="n">InputDataDirectory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">home_var</span> <span class="o">=</span> <span class="n">HomeVariables</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">input_data_dir_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;input_data_dir_list&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">input_data_dirs</span> <span class="o">=</span> <span class="n">input_data_dirs</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">input_data_dirs</span> <span class="o">=</span> <span class="n">input_data_dirs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">InputDataDirectory</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">InputDataDirectory</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_data_dirs_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dir_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;input_data_dirs_select&#39;</span><span class="p">):</span>
                <span class="n">cur_dir</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">InputDataDirectory</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">dir_id</span><span class="p">)</span>
                <span class="n">input_data_dir_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_dir</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_dir</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

                <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span><span class="p">,</span>
                                        <span class="n">cur_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

            <span class="n">input_data_dir_name</span> <span class="o">=</span> <span class="n">input_data_dir_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;input_data_dir_list&#39;</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s1">u&#39;Input Data Directorys &quot;</span><span class="si">{0}</span><span class="s1">&quot;: deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">input_data_dir_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_dir</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">InputDataDirectory</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">input_data_dir_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_dir</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">cur_dir</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">RF_AUXDATA_DIR</span><span class="p">,</span> <span class="n">cur_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;input_data_dir_list&#39;</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s1">u&#39;Input Data Directory &quot;</span><span class="si">{0}</span><span class="s1">&quot;: deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">input_data_dir_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;input_data_dir_list&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Directory or more Directorys.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">input_data_dirs</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;input_data_dirs&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># InputDataDirectory add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="input_data_dir_add"><a class="viewcode-back" href="../gsi.html#gsi.views.input_data_dir_add">[docs]</a><span class="k">def</span> <span class="nf">input_data_dir_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Input Data Directory Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;input_data_dir_add&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;input_data_dir_list&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_input_data_dir_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_list&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_list&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">data_dir_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">available_files</span> <span class="o">=</span> <span class="n">InputDataDirectory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">InputDataDirectoryForm</span><span class="p">,</span>
                            <span class="s1">&#39;Input Data Directory&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputDataDirectoryForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;available_files&#39;</span><span class="p">:</span> <span class="n">available_files</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># InputDataDirectory edit</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="input_data_dir_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.input_data_dir_edit">[docs]</a><span class="k">def</span> <span class="nf">input_data_dir_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">dir_id</span><span class="p">):</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">InputDataDirectory</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">dir_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Input Data Directory Edit &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;input_data_dir_list&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;input_data_dir_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_input_data_dir_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_list&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_list&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">data_dir_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">InputDataDirectoryForm</span><span class="p">,</span>
            <span class="s1">&#39;Input Data Directory&#39;</span><span class="p">,</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputDataDirectoryForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">data_dir</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">dir_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Cards List</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/cards_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="cards_list"><a class="viewcode-back" href="../gsi.html#gsi.views.cards_list">[docs]</a><span class="k">def</span> <span class="nf">cards_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Editing Cards&#39;</span>
    <span class="n">cards_all</span> <span class="o">=</span> <span class="n">CardItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">card_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cards_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;cards_list&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;content_type__model&#39;</span><span class="p">):</span>
            <span class="n">cards_all</span> <span class="o">=</span> <span class="n">cards_all</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">cards_all</span> <span class="o">=</span> <span class="n">cards_all</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">card_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">card_id</span><span class="p">:</span>
                <span class="n">cur_card</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardItem</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_card</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">card_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_card</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardItem</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">card_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_card</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;card_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">card_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;card_select&#39;</span><span class="p">):</span>
                <span class="n">cur_card</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardItem</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span>
                <span class="n">cards_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_card</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">content_type_card</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">cur_card</span><span class="o">.</span><span class="n">content_type_id</span><span class="p">)</span>
                <span class="n">class_obj</span> <span class="o">=</span> <span class="n">content_type_card</span><span class="o">.</span><span class="n">get_object_for_this_type</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cur_card</span><span class="p">))</span>
                <span class="c1"># print &#39;str(cur_card) =========================== &#39;, str(cur_card)</span>
                <span class="n">cur_card</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                <span class="n">class_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">cards_name</span> <span class="o">=</span> <span class="n">cards_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># print &#39;cards_name ===================== &#39;, cards_name</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;cards_list&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Cards: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cards_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_card</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">CardItem</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">cards_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_card</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">content_type_card</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">cur_card</span><span class="o">.</span><span class="n">content_type_id</span><span class="p">)</span>
            <span class="n">class_obj</span> <span class="o">=</span> <span class="n">content_type_card</span><span class="o">.</span><span class="n">get_object_for_this_type</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cur_card</span><span class="p">))</span>
            <span class="n">cur_card</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">class_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;cards_list&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Card: </span><span class="si">{0}</span><span class="s1"> ==&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cards_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;cards_list&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Card or more Cards.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">cards_all</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;cards&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Cards List</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/card_editions.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="card_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.card_edit">[docs]</a><span class="k">def</span> <span class="nf">card_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">card_id</span><span class="p">):</span>
    <span class="n">data_card</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CardItem</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">card_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Card Editing &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data_card</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;cards_list&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;card_edit&#39;</span>
    <span class="n">card_model</span> <span class="o">=</span> <span class="n">data_card</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span> <span class="k">if</span> <span class="n">data_card</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span> <span class="o">!=</span> <span class="s1">&#39;yearfilter&#39;</span> <span class="k">else</span> <span class="s1">&#39;year_filter&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;cards/_</span><span class="si">{0}</span><span class="s1">_form.html&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card_model</span><span class="p">)</span>
    <span class="n">func_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;qrf&#39;</span><span class="p">:</span> <span class="n">qrf_update_create</span><span class="p">,</span>
        <span class="s1">&#39;rfscore&#39;</span><span class="p">:</span> <span class="n">rfscore_update_create</span><span class="p">,</span>
        <span class="s1">&#39;remap&#39;</span><span class="p">:</span> <span class="n">remap_update_create</span><span class="p">,</span>
        <span class="s1">&#39;yearfilter&#39;</span><span class="p">:</span> <span class="n">year_filter_update_create</span><span class="p">,</span>
        <span class="s1">&#39;collate&#39;</span><span class="p">:</span> <span class="n">collate_update_create</span><span class="p">,</span>
        <span class="s1">&#39;preproc&#39;</span><span class="p">:</span> <span class="n">preproc_update_create</span><span class="p">,</span>
        <span class="s1">&#39;mergecsv&#39;</span><span class="p">:</span> <span class="n">mergecsv_update_create</span><span class="p">,</span>
        <span class="s1">&#39;rftrain&#39;</span><span class="p">:</span> <span class="n">rftrain_update_create</span><span class="p">,</span>
        <span class="s1">&#39;randomforest&#39;</span><span class="p">:</span> <span class="n">randomforest_update_create</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">form_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;qrf&#39;</span><span class="p">:</span> <span class="n">QRFForm</span><span class="p">,</span>
        <span class="s1">&#39;rfscore&#39;</span><span class="p">:</span> <span class="n">RFScoreForm</span><span class="p">,</span>
        <span class="s1">&#39;remap&#39;</span><span class="p">:</span> <span class="n">RemapForm</span><span class="p">,</span>
        <span class="s1">&#39;yearfilter&#39;</span><span class="p">:</span> <span class="n">YearFilterForm</span><span class="p">,</span>
        <span class="s1">&#39;collate&#39;</span><span class="p">:</span> <span class="n">CollateForm</span><span class="p">,</span>
        <span class="s1">&#39;preproc&#39;</span><span class="p">:</span> <span class="n">PreProcForm</span><span class="p">,</span>
        <span class="s1">&#39;mergecsv&#39;</span><span class="p">:</span> <span class="n">MergeCSVForm</span><span class="p">,</span>
        <span class="s1">&#39;rftrain&#39;</span><span class="p">:</span> <span class="n">RFTrainForm</span><span class="p">,</span>
        <span class="s1">&#39;randomforest&#39;</span><span class="p">:</span> <span class="n">RandomForestForm</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># print &#39;template_name ========================= &#39;, template_name</span>
    <span class="c1"># print &#39;card_model ========================= &#39;, card_model</span>
    <span class="c1"># print &#39;data_card ========================= &#39;, data_card</span>

    <span class="n">content_type_name</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">app_label</span><span class="o">=</span><span class="s2">&quot;cards&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">data_card</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
    <span class="n">class_model</span> <span class="o">=</span> <span class="n">content_type_name</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
    <span class="n">card_name</span> <span class="o">=</span> <span class="n">content_type_name</span><span class="o">.</span><span class="n">get_object_for_this_type</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">data_card</span><span class="p">)</span>
    <span class="n">cur_card</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">class_model</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">card_name</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="c1"># print &#39;card_name ========================== &#39;, card_name</span>
    <span class="c1"># print &#39;class_model ========================== &#39;, class_model</span>
    <span class="c1"># print &#39;content_type_name ========================== &#39;, content_type_name</span>
    <span class="c1"># print &#39;card_name ID ========================== &#39;, card_name.id</span>

    <span class="c1"># template_name = &#39;gsi/_input_data_dir_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;cards_list&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;input_data_dir_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;cards_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;cards_list&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">func_dict</span><span class="p">[</span><span class="n">data_card</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span><span class="p">]</span>
    <span class="n">card_form</span> <span class="o">=</span> <span class="n">form_dict</span><span class="p">[</span><span class="n">data_card</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span><span class="p">]</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">card_form</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">content_type_name</span><span class="p">),</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">card_name</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">card_form</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">card_name</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;card_id&#39;</span><span class="p">:</span> <span class="n">card_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># audit history</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/audit_history.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="audit_history"><a class="viewcode-back" href="../gsi.html#gsi.views.audit_history">[docs]</a><span class="k">def</span> <span class="nf">audit_history</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="c1"># Audit record for  MATT_COLLATE_TESTR_29th_Feb</span>
    <span class="c1"># get_logs(element, element_id, limit=None, user=None)</span>
    <span class="n">run_base</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Audit record for &quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_logs</span><span class="p">(</span><span class="s1">&#39;RunBase&#39;</span><span class="p">,</span> <span class="n">run_base</span><span class="o">.</span><span class="n">id</span><span class="p">)))</span>
    <span class="n">logs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_logs</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">,</span> <span class="n">run_base</span><span class="o">.</span><span class="n">id</span><span class="p">)))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;logs&#39;</span><span class="p">:</span> <span class="n">logs</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># view results</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/view_results.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="view_results"><a class="viewcode-back" href="../gsi.html#gsi.views.view_results">[docs]</a><span class="k">def</span> <span class="nf">view_results</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="n">run_base</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;View results &quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">dir_root</span> <span class="o">=</span> <span class="n">get_dir_root_static_path</span><span class="p">()</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">run_base</span><span class="o">.</span><span class="n">resolution</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">run_base</span><span class="o">.</span><span class="n">directory_path</span>
    <span class="n">static_dir_root_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dir_root</span><span class="p">[</span><span class="s1">&#39;static_dir_root_path&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">resolution</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">static_dir_root_path</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span><span class="n">static_dir_root_path</span><span class="p">)</span>
    <span class="n">static_dir_root</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dir_root</span><span class="p">[</span><span class="s1">&#39;static_dir_root&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">resolution</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">static_dir_root</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span><span class="n">static_dir_root</span><span class="p">)</span>

    <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">info_message</span> <span class="o">=</span> <span class="n">get_files_dirs</span><span class="p">(</span><span class="n">static_dir_root</span><span class="p">,</span>
                                               <span class="n">static_dir_root_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">info_message</span><span class="p">:</span>
        <span class="n">info_message</span> <span class="o">=</span> <span class="s1">u&#39;For run &quot;</span><span class="si">{0}</span><span class="s1">&quot; there are no results to show.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;info_message&#39;</span><span class="p">:</span> <span class="n">info_message</span><span class="p">,</span>
        <span class="s1">&#39;dirs&#39;</span><span class="p">:</span> <span class="n">dirs</span><span class="p">,</span>
        <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="n">files</span><span class="p">,</span>
        <span class="s1">&#39;prev_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># view results</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/view_results_folder.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="view_results_folder"><a class="viewcode-back" href="../gsi.html#gsi.views.view_results_folder">[docs]</a><span class="k">def</span> <span class="nf">view_results_folder</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">prev_dir</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
    <span class="n">run_base</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">RunBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;View results &quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">back_prev</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">back_cur</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">dir_root</span> <span class="o">=</span> <span class="n">get_dir_root_static_path</span><span class="p">()</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">run_base</span><span class="o">.</span><span class="n">resolution</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">run_base</span><span class="o">.</span><span class="n">directory_path</span>

    <span class="n">static_dir_root_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dir_root</span><span class="p">[</span><span class="s1">&#39;static_dir_root_path&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">resolution</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">static_dir_root_path</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span><span class="n">static_dir_root_path</span><span class="p">)</span>
    <span class="n">static_dir_root</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dir_root</span><span class="p">[</span><span class="s1">&#39;static_dir_root&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">resolution</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">static_dir_root</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span><span class="n">static_dir_root</span><span class="p">)</span>
    <span class="n">static_dir_root_path_folder</span> <span class="o">=</span> <span class="n">static_dir_root_path</span>
    <span class="n">static_dir_root_folder</span> <span class="o">=</span> <span class="n">static_dir_root</span>

    <span class="k">if</span> <span class="n">prev_dir</span> <span class="o">!=</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">list_dir</span> <span class="o">=</span> <span class="n">prev_dir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
        <span class="n">back_prev</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_dir</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">back_cur</span> <span class="o">=</span> <span class="n">list_dir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_dir</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">back_prev</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span>
            <span class="n">back_cur</span> <span class="o">=</span> <span class="n">list_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prev_dir</span> <span class="o">+=</span> <span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="nb">dir</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">list_dir</span><span class="p">:</span>
            <span class="n">static_dir_root_path_folder</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">d</span>
            <span class="n">static_dir_root_folder</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">d</span>

        <span class="c1"># for new folder</span>
        <span class="n">static_dir_root_path_folder</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="n">static_dir_root_path_folder</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span>
            <span class="n">static_dir_root_path_folder</span><span class="p">)</span>
        <span class="n">static_dir_root_folder</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="n">static_dir_root_folder</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span><span class="n">static_dir_root_folder</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># for new folder</span>
        <span class="n">prev_dir</span> <span class="o">=</span> <span class="nb">dir</span>
        <span class="n">static_dir_root_path_folder</span> <span class="o">=</span> <span class="n">static_dir_root_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="n">static_dir_root_path_folder</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span>
            <span class="n">static_dir_root_path_folder</span><span class="p">)</span>
        <span class="n">static_dir_root_folder</span> <span class="o">=</span> <span class="n">static_dir_root</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="n">static_dir_root_folder</span> <span class="o">=</span> <span class="n">slash_remove_from_path</span><span class="p">(</span><span class="n">static_dir_root_folder</span><span class="p">)</span>

    <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">info_message</span> <span class="o">=</span> <span class="n">get_files_dirs</span><span class="p">(</span><span class="n">static_dir_root_folder</span><span class="p">,</span>
                                               <span class="n">static_dir_root_path_folder</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">info_message</span><span class="p">:</span>
        <span class="n">info_message</span> <span class="o">=</span> <span class="s1">u&#39;For run &quot;</span><span class="si">{0}</span><span class="s1">&quot; there are no results to show.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">run_base</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;prev_dir&#39;</span><span class="p">:</span> <span class="n">prev_dir</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;info_message&#39;</span><span class="p">:</span> <span class="n">info_message</span><span class="p">,</span>
        <span class="s1">&#39;dirs&#39;</span><span class="p">:</span> <span class="n">dirs</span><span class="p">,</span>
        <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="n">files</span><span class="p">,</span>
        <span class="s1">&#39;back_prev&#39;</span><span class="p">:</span> <span class="n">back_prev</span><span class="p">,</span>
        <span class="s1">&#39;back_cur&#39;</span><span class="p">:</span> <span class="n">back_cur</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Resolution list</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/resolution_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="resolution"><a class="viewcode-back" href="../gsi.html#gsi.views.resolution">[docs]</a><span class="k">def</span> <span class="nf">resolution</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Resolutions&#39;</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">resolution_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;resolution&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">):</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Resolution</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Resolution</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resolution_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">satellite_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;resolution_select&#39;</span><span class="p">):</span>
                <span class="n">cur_resolution</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Resolution</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">satellite_id</span><span class="p">)</span>
                <span class="n">resolution_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_resolution</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_resolution</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">resolution_name</span> <span class="o">=</span> <span class="n">resolution_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Resolutions &quot;</span><span class="si">{0}</span><span class="s1">&quot; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resolution_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_resolution</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">Resolution</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">resolution_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_resolution</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">cur_resolution</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Resolution &quot;</span><span class="si">{0}</span><span class="s1">&quot; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resolution_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Resolution or more Resolutions.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;resolutions&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Resolution add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="resolution_add"><a class="viewcode-back" href="../gsi.html#gsi.views.resolution_add">[docs]</a><span class="k">def</span> <span class="nf">resolution_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Resolution Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;resolution_add&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;resolution&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_resolution_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">resolution_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">available_resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">ResolutionForm</span><span class="p">,</span> <span class="s1">&#39;Resolution&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span>
                            <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ResolutionForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;available_resolution&#39;</span><span class="p">:</span> <span class="n">available_resolution</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Resolution edit</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="resolution_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.resolution_edit">[docs]</a><span class="k">def</span> <span class="nf">resolution_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">resolution_id</span><span class="p">):</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Resolution</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">resolution_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Resolution Edit &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resolution</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;resolution&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;resolution_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_resolution_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;resolution&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">resolution_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">ResolutionForm</span><span class="p">,</span>
            <span class="s1">&#39;Resolution&#39;</span><span class="p">,</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">resolution_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ResolutionForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">resolution_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Tiles list</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/tiles_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="tiles"><a class="viewcode-back" href="../gsi.html#gsi.views.tiles">[docs]</a><span class="k">def</span> <span class="nf">tiles</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Tiles&#39;</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">tile_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;tiles&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,):</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="n">tile</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">tile</span> <span class="o">=</span> <span class="n">tile</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Tile</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Tile</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tile_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tile_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;tile_select&#39;</span><span class="p">):</span>
                <span class="n">cur_tile</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Tile</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">tile_id</span><span class="p">)</span>
                <span class="n">tile_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_tile</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_tile</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">tile_name</span> <span class="o">=</span> <span class="n">tile_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;tiles&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Tiles &quot;</span><span class="si">{0}</span><span class="s1">&quot; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tile_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_tile</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">Tile</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">tile_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_tile</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">cur_tile</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;tiles&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Tile &quot;</span><span class="si">{0}</span><span class="s1">&quot; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tile_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;tiles&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Tile or more Tiles.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tile</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;tiles&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Tiles add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="tile_add"><a class="viewcode-back" href="../gsi.html#gsi.views.tile_add">[docs]</a><span class="k">def</span> <span class="nf">tile_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Tile Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;tile_add&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;tiles&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_tile_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;tiles&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;tile_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;tile_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;tiles&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">tile_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">available_tiles</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">TileForm</span><span class="p">,</span> <span class="s1">&#39;Tile&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span>
                            <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TileForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;available_tiles&#39;</span><span class="p">:</span> <span class="n">available_tiles</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Tiles edit</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="tile_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.tile_edit">[docs]</a><span class="k">def</span> <span class="nf">tile_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tile_id</span><span class="p">):</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Tile</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">tile_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Tile Edit &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;tiles&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;tile_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_tile_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;tiles&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;tile_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;tile_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;tiles&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">tile_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">TileForm</span><span class="p">,</span>
            <span class="s1">&#39;Tile&#39;</span><span class="p">,</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">tile_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TileForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">tile</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">tile_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Years list</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/years_list.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="years"><a class="viewcode-back" href="../gsi.html#gsi.views.years">[docs]</a><span class="k">def</span> <span class="nf">years</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Years&#39;</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">Year</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">year_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;years&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order_by&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,):</span>
            <span class="n">years</span> <span class="o">=</span> <span class="n">years</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">years</span> <span class="o">=</span> <span class="n">years</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">data_post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="s1">&#39;run_id[]&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove these objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;run_id[]&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run_id</span><span class="p">:</span>
                <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;cur_run_id&#39;</span> <span class="ow">in</span> <span class="n">data_post</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">u&#39;Are you sure you want to remove this objects:&#39;</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">data_post</span><span class="p">[</span><span class="s1">&#39;cur_run_id&#39;</span><span class="p">]</span>
            <span class="n">cur_run</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_run</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/b&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># if request.POST.get(&#39;delete_button&#39;):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;year_select&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">year_id</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;year_select&#39;</span><span class="p">):</span>
                <span class="n">cur_year</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">year_id</span><span class="p">)</span>
                <span class="n">year_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_year</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &#39;</span>
                <span class="n">cur_year</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">year_name</span> <span class="o">=</span> <span class="n">year_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;years&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Tiles &quot;</span><span class="si">{0}</span><span class="s1">&quot; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year_name</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">):</span>
            <span class="n">cur_year</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">Year</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_button&#39;</span><span class="p">))</span>
            <span class="n">year_name</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">cur_year</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">cur_year</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?status_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;years&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">u&#39;Year &quot;</span><span class="si">{0}</span><span class="s1">&quot; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year_name</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">u&#39;</span><span class="si">%s</span><span class="s1">?warning_message=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;years&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">u&quot;To delete, select Year or more Years.&quot;</span><span class="p">)))</span>

    <span class="c1"># paginations</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">paginations</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;years&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Year add</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="year_add"><a class="viewcode-back" href="../gsi.html#gsi.views.year_add">[docs]</a><span class="k">def</span> <span class="nf">year_add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Year Add&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;year_add&#39;</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;years&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_year_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;year_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;year_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">year_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">available_years</span> <span class="o">=</span> <span class="n">Year</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">YearForm</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">reverse_url</span><span class="p">,</span>
                            <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">YearForm</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;available_years&#39;</span><span class="p">:</span> <span class="n">available_years</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Year edit</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/static_data_item_edit.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="year_edit"><a class="viewcode-back" href="../gsi.html#gsi.views.year_edit">[docs]</a><span class="k">def</span> <span class="nf">year_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year_id</span><span class="p">):</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">year_id</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Year Edit &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;years&#39;</span>
    <span class="n">but_name</span> <span class="o">=</span> <span class="s1">&#39;static_data&#39;</span>
    <span class="n">url_form</span> <span class="o">=</span> <span class="s1">&#39;year_edit&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;gsi/_year_form.html&#39;</span>
    <span class="n">reverse_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;save_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_another&#39;</span><span class="p">:</span> <span class="s1">&#39;year_add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;save_and_continue&#39;</span><span class="p">:</span> <span class="s1">&#39;year_edit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cancel_button&#39;</span><span class="p">:</span> <span class="s1">&#39;years&#39;</span>
    <span class="p">}</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">year_update_create</span>
    <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_post</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">YearForm</span><span class="p">,</span>
            <span class="s1">&#39;Year&#39;</span><span class="p">,</span>
            <span class="n">reverse_url</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">item_id</span><span class="o">=</span><span class="n">year_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">YearForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;url_form&#39;</span><span class="p">:</span> <span class="n">url_form</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;but_name&#39;</span><span class="p">:</span> <span class="n">but_name</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="n">year_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># view Customer section</span>
<span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s1">&#39;gsi/customer_section.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="customer_section"><a class="viewcode-back" href="../gsi.html#gsi.views.customer_section">[docs]</a><span class="k">def</span> <span class="nf">customer_section</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Customer </span><span class="si">{0}</span><span class="s1"> section&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
    <span class="n">url_name</span> <span class="o">=</span> <span class="s1">&#39;customer_section&#39;</span>
    <span class="n">eLat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">eLng</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">data_request</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>

        <span class="k">if</span> <span class="n">data_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;eLat&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">eLat</span> <span class="o">=</span> <span class="n">data_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;eLat&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;eLng&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">eLng</span> <span class="o">=</span> <span class="n">data_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;eLng&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>


    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s1">&#39;customer&#39;</span><span class="p">:</span> <span class="n">customer</span><span class="p">,</span>
        <span class="s1">&#39;url_name&#39;</span><span class="p">:</span> <span class="n">url_name</span><span class="p">,</span>
        <span class="s1">&#39;eLat&#39;</span><span class="p">:</span> <span class="n">eLat</span><span class="p">,</span>
        <span class="s1">&#39;eLng&#39;</span><span class="p">:</span> <span class="n">eLng</span><span class="p">,</span>
        <span class="s1">&#39;GOOGLE_MAP_ZOOM&#39;</span><span class="p">:</span> <span class="n">GOOGLE_MAP_ZOOM</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">GSi 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, KeyUA.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>